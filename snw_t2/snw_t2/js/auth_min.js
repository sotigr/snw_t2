function HashTable(e) { this.length = 0, this.items = {}; for (var t in e) e.hasOwnProperty(t) && (this.items[t] = e[t], this.length++); this.setItem = function (e, t) { var r = void 0; return this.hasItem(e) ? r = this.items[e] : this.length++, this.items[e] = t, r }, this.getItem = function (e) { return this.hasItem(e) ? this.items[e] : void 0 }, this.hasItem = function (e) { return this.items.hasOwnProperty(e) }, this.removeItem = function (e) { return this.hasItem(e) ? (previous = this.items[e], this.length--, delete this.items[e], previous) : void 0 }, this.keys = function () { var e = []; for (var t in this.items) this.hasItem(t) && e.push(t); return e }, this.values = function () { var e = []; for (var t in this.items) this.hasItem(t) && e.push(this.items[t]); return e }, this.each = function (e) { for (var t in this.items) this.hasItem(t) && e(t, this.items[t]) }, this.clear = function () { this.items = {}, this.length = 0 } } function UpdateUrlParameters() { var e = "?", t = parameter_table.keys().length; if (t > 0) { var r = 0; for (var n in parameter_table.items) parameter_table.hasItem(n) && "undefined" !== parameter_table.items[n] && (e += r == t - 1 ? n + "=" + parameter_table.items[n] : n + "=" + parameter_table.items[n] + "&"), r += 1; window.history.pushState("object or string", "Title", e) } else window.history.pushState("object or string", "Title", "/") } function SetUrlParameter(e, t) { parameter_table.setItem(e, t), UpdateUrlParameters() } function ClearUrlParameters() { parameter_table.clear(), UpdateUrlParameters() } function RemoveUrlParameter(e) { parameter_table.removeItem(e), UpdateUrlParameters() } function GetUrlParameter(e) { var t, r, n = decodeURIComponent(window.location.search.substring(1)), a = n.split("&"); for (r = 0; r < a.length; r++) if (t = a[r].split("="), t[0] === e) return void 0 === t[1] ? !0 : t[1] } function stringToByteArray(e) { for (var t = [], r = 0; r < e.length; ++r) t.push(e.charCodeAt(r)); return t } function ArrayCopy(e, t, r, n) { for (var a = new Array, i = 0, o = t; t + n > o; o++) a[i + r] = e[o], i++; return a } function toUTF8String(e) { var t, r = ""; for (t = 0; t < e.length; t++) r += "%" + ("0" + e[t].toString(16)).slice(-2); return decodeURIComponent(r) } function toUTF8Array(e) { for (var t = [], r = 0; r < e.length; r++) { var n = e.charCodeAt(r); 128 > n ? t.push(n) : 2048 > n ? t.push(192 | n >> 6, 128 | 63 & n) : 55296 > n || n >= 57344 ? t.push(224 | n >> 12, 128 | n >> 6 & 63, 128 | 63 & n) : (r++, n = 65536 + ((1023 & n) << 10 | 1023 & e.charCodeAt(r)), t.push(240 | n >> 18, 128 | n >> 12 & 63, 128 | n >> 6 & 63, 128 | 63 & n)) } return t } function toBigIntegerArray(e) { for (var t = new Array, r = 0; r < e.length; r++) t[r] = BigInteger(e[r]); return t } function toBase64(e) { return btoa(String.fromCharCode.apply(null, e)) } function fromBase64(e) { return atob(e) } function rsa_encrypt(e, t, r) { for (var n = e.length, a = new Array, i = toBigIntegerArray(e), o = 0; n > o; o++) a[o] = i[o].modPow(t, r); return a } function getRandomIntInclusive(e, t) { return Math.floor(Math.random() * (t - e + 1)) + e } function createrandompass(e) { for (var t = "", r = 0; e > r; r++) t += String.fromCharCode(getRandomIntInclusive(33, 125)); return t = t.replace("\\", "^").replace("/", "@").replace('"', "_").replace("'", " !"), t.length != e ? createrandompass(e) : t } function beginAuthentication() { if ("True" == use_encryption) if ("False" == aes_decryption_token_received) { o = createrandompass(16), s = createrandompass(16), $.jStorage.set("aes_key_string", o), $.jStorage.set("aes_iv_string", s); for (var e = BigInteger(rsa_e), t = BigInteger(rsa_n), r = toUTF8Array(o + " " + s), n = rsa_encrypt(r, e, t), a = "", i = 0; i < n.length; i++) a += n[i].toString() + " "; AjaxHelper.PostAsync("/api/apply_decryption_token", { key: toBase64(stringToByteArray(a)) }, function (e) { "Bad token" == e ? beginAuthentication() : "ok" != e ? (alert(e), location.reload()) : (aes_decryption_token_received = "True", beginAuthentication()) }) } else var o = $.jStorage.get("aes_key_string"), s = $.jStorage.get("aes_iv_string"); continue_after_auth() } function encrypt(e) { var t = CryptoJS.AES.encrypt(e, CryptoJS.enc.Utf8.parse($.jStorage.get("aes_key_string")), { keySize: 16, iv: CryptoJS.enc.Utf8.parse($.jStorage.get("aes_iv_string")), padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }); return t } function decrypt(e) { var t = CryptoJS.AES.decrypt(e, CryptoJS.enc.Utf8.parse($.jStorage.get("aes_key_string")), { keySize: 16, iv: CryptoJS.enc.Utf8.parse($.jStorage.get("aes_iv_string")), padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }); return t.toString(CryptoJS.enc.Utf8) } function getbetween(e, t, r) { return e.substring(e.lastIndexOf(t) + t.length, e.lastIndexOf(r)) } function navigate_base(e, t) { "True" == use_encryption && "True" == aes_decryption_token_received && (("" == e.trim() || "/" == e.trim()) && (e = "?"), AjaxHelper.PostAsync("/api/page_provider", { path: encrypt(e) }, function (r) { var n = decrypt(r), a = getbetween(n, "<head>", "</head>"); if ($("head").html(a), iframe.contentWindow.document.open(), iframe.contentWindow.document.write(n), iframe.contentWindow.document.close(), $(iframe).contents().find(document).trigger("ready"), "?" != e ? SetUrlParameter("wpg", e) : RemoveUrlParameter("wpg"), void 0 !== t) for (var i = 0; i < t.length; i++) SetUrlParameter(t[i].name, t[i].value); $(iframe).contents().find(document).trigger("ready") })) } function navigateAbs(e) { navigate_base(e) } function navigate(e, t) { ClearUrlParameters(), navigate_base(e, t) } function continue_after_auth() { navigateAbs(void 0 === GetUrlParameter("wpg") ? "/" : GetUrlParameter("wpg")) } var QueryString = function () { for (var e = {}, t = window.location.search.substring(1), r = t.split("&"), n = 0; n < r.length; n++) { var a = r[n].split("="); if ("undefined" == typeof e[a[0]]) e[a[0]] = decodeURIComponent(a[1]); else if ("string" == typeof e[a[0]]) { var i = [e[a[0]], decodeURIComponent(a[1])]; e[a[0]] = i } else e[a[0]].push(decodeURIComponent(a[1])) } return e }(), parameter_table = new HashTable, aes_key_string, aes_iv_string, iframe; window.onpopstate = function (e) { continue_after_auth() }, window.onload = function () { iframe = document.createElement("iframe"), document.body.appendChild(iframe), $(iframe).css("position", "absolute"), $(iframe).css("top", "0"), $(iframe).css("left", "0"), $(iframe).css("width", "100%"), $(iframe).css("height", "100%"), $(iframe).attr("frameborder", "0"); for (key in QueryString) parameter_table.setItem(key, QueryString[key]); beginAuthentication() }, window.onunload = function () { };